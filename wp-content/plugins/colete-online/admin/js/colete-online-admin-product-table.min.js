"use strict";function _createForOfIteratorHelper(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,e=function(){};return{s:e,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}!function(h){h.fn.ColeteOnlineProductTable=function(){var t=[];return this.each(function(){t.push(new h.ColeteOnlineProductTable(h(this)))}),t},h.ColeteOnlineProductTable=function(t){var s=this;this.element=t,this.subscribers={validityChanges:[]};var d=[];this.unique=0,h(t).find("[data-package]").each(function(t,e){var n=h(e),a=+n[0].dataset.package,i=+n.find("[data-package-weight]")[0].dataset.packageWeight,o=+n.find("[data-package-width]")[0].dataset.packageWidth,l=+n.find("[data-package-length]")[0].dataset.packageLength,c=+n.find("[data-package-height]")[0].dataset.packageHeight,r=n.find(".coleteonline-product-name").text(),e=n.find(".coleteonline-thumb").html();void 0===d[a]&&(d[a]=[]),d[a].push({el:n,unique:++s.unique,name:r,thumbnail:e,weight:i,width:o,length:l,height:c,manual:!1,editable:!1})}),this.productPackages=d.filter(function(t){return t}),this.initialPackages=JSON.parse(JSON.stringify(this.productPackages)),this.totals=[],this.render(),h(".coleteonline-add-package").click(this.addPackage.bind(this)),h(".coleteonline-reset-packages").click(this.resetAndRender.bind(this))},h.ColeteOnlineProductTable.prototype.render=function(){var t=this.productPackages,e=h(this.element).find("tbody");e.empty();for(var n=0,a=0;a<t.length;++a)void 0!==t[a]&&t[a].length&&++n;for(var i=0;i<t.length;++i){var o,l=t[i],c=_createForOfIteratorHelper(l);try{for(c.s();!(o=c.n()).done;){var r=o.value;if(r.manual&&1<l.length&&(r.editable=!0),!r.manual||r.editable){for(var s='<select\n          class="coleteonline-package-select-input"\n          name="coleteonline-package-select-input">',d=0;d<=n;++d)s+='<option value="'.concat(d+1,'"\n            ').concat(d+1===i+1?"selected":"","\n          >").concat(d+1,"</option>");s+="</select>",e.append(h('\n          <tr data-package="'.concat(i+1,'"\n            data-unique="').concat(r.unique,'"\n            class="product-row">\n            <td class="coleteonline-thumb">\n              ').concat(r.thumbnail,'\n            </td>\n            <td class="coleteonline-product-name">\n              ').concat(r.name,'\n            </td>\n            <td class="coleteonline-package-select">\n              ').concat(s,'\n            </td>\n            <td class="coleteonline-package-weight"\n              data-package-weight="').concat(r.weight,'"\n              data-type="weight"\n            >\n              ').concat(r.editable?'<input type="text" class="coleteonline-package-input coleteonline-package-weight-input" name="coleteonline-package-weight-input" value="'+r.weight+'"/>':r.weight,' kg\n            </td>\n            <td class="coleteonline-package-dimensions width"\n              data-package-width="').concat(r.width,'"\n              data-type="width"\n            >\n              ').concat(r.editable?'<input type="text" class="coleteonline-package-input coleteonline-package-width-input" name="coleteonline-package-width-input" value="'+r.width+'"/>':r.width,' cm\n            </td>\n            <td class="coleteonline-package-dimensions length"\n              data-package-length="').concat(r.length,'"\n              data-type="length"\n            >\n              ').concat(r.editable?'<input type="text" class="coleteonline-package-input coleteonline-package-length-input" name="coleteonline-package-length-input" value="'+r.length+'"/>':r.length,' cm\n            </td>\n            <td class="coleteonline-package-dimensions height"\n              data-package-height="').concat(r.height,'"\n              data-type="height"\n            >\n              ').concat(r.editable?'<input type="text" class="coleteonline-package-input coleteonline-package-height-input" name="coleteonline-package-height-input" value="'+r.height+'"/>':r.height,' cm\n            </td>\n            <td>\n              <button type="button" class="button coleteonline-remove-item">\n                Del\n              </button>\n            </td>\n          </tr>')))}}}catch(t){c.e(t)}finally{c.f()}l.length&&this.renderTotalRow(l,i)}h("#coleteonline-order-content-input").val(this.getContent.bind(this)),h(".coleteonline-package-select-input").unbind("change"),h(".coleteonline-package-select-input").change(this.packageChanged.bind(this)),h(".coleteonline-package-input").unbind("change"),h(".coleteonline-package-input").change(this.packageCharacteristicsChanged.bind(this)),h(".coleteonline-add-item").unbind("click"),h(".coleteonline-add-item").click(this.addItem.bind(this)),h(".coleteonline-remove-item").unbind("click"),h(".coleteonline-remove-item").click(this.removeItem.bind(this)),h(".coleteonline-remove-package").unbind("click"),h(".coleteonline-remove-package").click(this.removePackage.bind(this)),h(".total-row").find("input").unbind("change"),h(".total-row").find("input").change(this.totalRowChange.bind(this)),this.validateAllFields()},h.ColeteOnlineProductTable.prototype.renderTotalRow=function(t,e){var n=!1;void 0===this.totals[e]&&(this.totals[e]={weight:0,width:0,length:0,height:0},n=!0);var a=this.totals[e];if(n){var i,o=_createForOfIteratorHelper(t);try{for(o.s();!(i=o.n()).done;){var l=i.value;a.weight+=l.weight,a.width=Math.max(l.width,a.width),a.length=Math.max(l.length,a.length),a.height=Math.max(l.height,a.height)}}catch(t){o.e(t)}finally{o.f()}}h(this.element).find("tbody").append('\n      <tr class="total-row" data-total-package="'.concat(e,'">\n        <td colspan="3">\n          Total ').concat(e+1,'\n          <button type="button" class="button coleteonline-add-item">\n            +\n          </button>\n        </td>\n        <td>\n          <input type="text"\n            class="coleteonline-package-weight-total-input"\n            name="coleteonline-package-weight-total-input"\n            data-type="weight"\n            value="').concat(a.weight,'"/> kg\n        </td>\n        <td>\n          <input type="text"\n            class="coleteonline-package-width-total-input"\n            name="coleteonline-package-width-total-input"\n            data-type="width"\n            value="').concat(a.width,'"/> cm\n        </td>\n        <td>\n          <input type="text"\n            class="coleteonline-package-length-total-input"\n            name="coleteonline-package-length-total-input"\n            data-type="length"\n            value="').concat(a.length,'"/> cm\n        </td>\n        <td>\n          <input type="text"\n            class="coleteonline-package-height-total-input"\n            name="coleteonline-package-height-total-input"\n            data-type="height"\n            value="').concat(a.height,'"/> cm\n        </td>\n        <td>\n          <button type="button" class="button coleteonline-remove-package">\n            Del\n          </button>\n        </td>\n      </tr>\n    '))},h.ColeteOnlineProductTable.prototype.packageChanged=function(t){var e=h(t.target),n=h(t.target).val(),a=+e.closest("tr")[0].dataset.unique,t=this.findItem(a),e=t.i,a=t.j,t=t.found;this.productPackages[e].splice(a,1),void 0===this.productPackages[n-1]&&(this.productPackages[n-1]=[]),this.productPackages[n-1].push(t),this.productPackages=this.productPackages.filter(function(t){return t&&t.length}),this.totals[e]=void 0,this.render()},h.ColeteOnlineProductTable.prototype.addPackage=function(t){this.productPackages[this.productPackages.length]=[{unique:++this.unique,name:"-",thumbnail:"",weight:1,width:15,length:15,height:15,manual:!0,editable:!1}],this.render()},h.ColeteOnlineProductTable.prototype.addItem=function(t){t=+h(t.target).parents("tr")[0].dataset.totalPackage;this.productPackages[t].push({unique:++this.unique,name:"-",thumbnail:"",weight:1,width:15,length:15,height:15,manual:!0,editable:!1}),this.totals[t]=void 0,this.render()},h.ColeteOnlineProductTable.prototype.removeItem=function(t){var e=+h(t.target).closest("tr")[0].dataset.unique,t=this.findItem(e),e=t.i,t=t.j;this.productPackages[e].splice(t,1),this.totals[e]=void 0,this.productPackages=this.productPackages.filter(function(t){return t&&t.length}),this.productPackages.length||this.reset(),this.render()},h.ColeteOnlineProductTable.prototype.removePackage=function(t){t=+h(t.target).closest("tr")[0].dataset.totalPackage;this.productPackages.splice(t,1),this.totals.splice(t,1),this.productPackages=this.productPackages.filter(function(t){return t&&t.length}),this.productPackages.length||this.reset(),this.render()},h.ColeteOnlineProductTable.prototype.packageCharacteristicsChanged=function(t){var e=h(t.target),n=+e.val(),a=e.parents("td")[0].dataset.type,t=+e.closest("tr")[0].dataset.unique,e=this.findItem(t),t=e.i;e.found[a]=+n,this.totals[t]=void 0,this.render()},h.ColeteOnlineProductTable.prototype.totalRowChange=function(t){var e=h(t.target),n=+h(e).val(),a=e[0].dataset.type,t=+e.parents("tr")[0].dataset.totalPackage;this.totals[t][a]=n,this.validateDimension(e,a,n),this.notifyValidity()},h.ColeteOnlineProductTable.prototype.validateAllFields=function(){var a=this;h("input.coleteonline-package-input").each(function(t,e){var n=h(e).closest("td")[0].dataset.type;a.validateDimension(e,n,h(e).val())}),h(".total-row input").each(function(t,e){var n=e.dataset.type;a.validateDimension(e,n,h(e).val())}),this.notifyValidity()},h.ColeteOnlineProductTable.prototype.validateDimension=function(t,e,n){"weight"===e&&(isNaN(n)||n<.1?this.addInvalidClass(t):this.removeInvalidClass(t)),"length"!==e&&"width"!==e||(isNaN(n)||n<3?this.addInvalidClass(t):this.removeInvalidClass(t)),"height"===e&&(isNaN(n)||n<1?this.addInvalidClass(t):this.removeInvalidClass(t))},h.ColeteOnlineProductTable.prototype.subscribe=function(t,e){this.subscribers[t].push(e),this.notifyValidity()},h.ColeteOnlineProductTable.prototype.notifyValidity=function(){var t,e=h(".coleteonline-packages-table .coleteonline-invalid").length,n=_createForOfIteratorHelper(this.subscribers.validityChanges);try{for(n.s();!(t=n.n()).done;){var a=t.value;a(0===e?"VALID":"INVALID")}}catch(t){n.e(t)}finally{n.f()}},h.ColeteOnlineProductTable.prototype.checkValidity=function(){var t,e=h(".coleteonline-packages-table .coleteonline-invalid").length,n=_createForOfIteratorHelper(this.subscribers.validityChanges);try{for(n.s();!(t=n.n()).done;){t.value;return 0===e?"VALID":"INVALID"}}catch(t){n.e(t)}finally{n.f()}},h.ColeteOnlineProductTable.prototype.addInvalidClass=function(t){h(t).addClass("coleteonline-invalid")},h.ColeteOnlineProductTable.prototype.removeInvalidClass=function(t){h(t).removeClass("coleteonline-invalid")},h.ColeteOnlineProductTable.prototype.reset=function(){this.productPackages=JSON.parse(JSON.stringify(this.initialPackages)),this.totals=[]},h.ColeteOnlineProductTable.prototype.resetAndRender=function(){this.reset(),this.render()},h.ColeteOnlineProductTable.prototype.findItem=function(t){var e,n;t:for(e=0;e<this.productPackages.length;++e)for(n=0;n<this.productPackages[e].length;++n)if(this.productPackages[e][n].unique===t)break t;var a=this.productPackages[e][n];if(void 0===a)throw"Package not found error";return{i:e,j:n,found:a}},h.ColeteOnlineProductTable.prototype.getPackagesTotals=function(){return this.totals},h.ColeteOnlineProductTable.prototype.getContent=function(){var t,e={},n=_createForOfIteratorHelper(this.productPackages);try{for(n.s();!(t=n.n()).done;){var a,i=_createForOfIteratorHelper(t.value);try{for(i.s();!(a=i.n()).done;){var o=a.value.name;void 0===e[o]&&(e[o]=0),++e[o]}}catch(t){i.e(t)}finally{i.f()}}}catch(t){n.e(t)}finally{n.f()}var l,c=[];for(l in e)e.hasOwnProperty(l)&&(1<e[l]?c.push("".concat(e[l]," x ").concat(l)):c.push(l));return c.join(", ").substr(0,50)}}(jQuery);