"use strict";function _createForOfIteratorHelper(e,o){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||o&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,t=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw t}}}}function _unsupportedIterableToArray(e,o){if(e){if("string"==typeof e)return _arrayLikeToArray(e,o);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,o):void 0}}function _arrayLikeToArray(e,o){(null==o||o>e.length)&&(o=e.length);for(var n=0,r=new Array(o);n<o;n++)r[n]=e[n];return r}!function(c){var e;function n(){0<c("#coleteonline_order_shipping_wrapper .coleteonline-invalid").length?c(".coleteonline-do-fetch-services-list").prop("disabled",!0):c(".coleteonline-do-fetch-services-list").prop("disabled",!1)}var r=c(".coleteonline-packages-table").ColeteOnlineProductTable();function t(){return{repaymentAmount:+c("#coleteonline-repayment-amount").val(),insuranceAmount:+c("#coleteonline-insurance-amount").val(),openAtDelivery:c("#coleteonline-open-package").is(":checked")}}function i(e,o){if("ServerError"!==e.error&&"Error"!==e.error||c(o).html('<div class="coleteonline-notice-error">\n          '.concat(e.message,"\n        </div>")),"BadRequestError"===e.error){var n="";if(e.validationErrors){var r,n="<ul>",t=_createForOfIteratorHelper(e.validationErrors);try{for(t.s();!(r=t.n()).done;){var a=r.value;n+="<li>".concat(a.field," - ").concat(a.message,"</li>")}}catch(e){t.e(e)}finally{t.f()}n+="</ul>"}c(o).html('<div class="coleteonline-notice-error">\n          '.concat(e.message,"\n          ").concat(n,"\n        </div>"))}}function a(){c(".coleteonline-file-download-loading").hide(),c(".coleteonline-do-download-awb").click(function(r){c(".coleteonline-file-download-loading").show(),c(".coleteonline-do-download-awb").hide(),c.get(ajaxurl,{action:"coleteonline_get_order_label",data:{uniqueId:r.target.dataset.uniqueId}},function(e){e=JSON.parse(e);var o="awb_".concat(r.target.dataset.uniqueId,".pdf"),n=e.data.length,n=new ArrayBuffer(n),n=new Uint8Array(n);n.set(e.data);e=new Blob([n],{type:"application/pdf"});window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(e,o):(n=window.URL.createObjectURL(e),(e=document.createElement("a")).href=n,e.download=o,document.body.appendChild(e),e.click(),document.body.removeChild(e)),c(".coleteonline-file-download-loading").hide(),c(".coleteonline-do-download-awb").show()})})}null==r||null!==(e=r[0])&&void 0!==e&&e.subscribe("validityChanges",function(){n()}),c("#coleteonline-repayment-amount, #coleteonline-insurance-amount").change(function(e){var o=c(e.target),e=+o.val();isNaN(e)||e<0?c(o).addClass("coleteonline-invalid"):c(o).removeClass("coleteonline-invalid"),n()}),c("#coleteonline-repayment-amount, #coleteonline-insurance-amount").trigger("change"),c(".coleteonline-change-address").click(function(){c(".coleteonline-address-select-wrapper").show(),c.post(ajaxurl,{action:"coleteonline_get_all_addresses"},function(r){r=JSON.parse(r);for(var e=c("#coleteonline-address-select"),o=[],n=0;n<r.addresses.length;++n){var t=r.addresses[n];o.push(new Option(t.shortName+" - "+t.address,t.id,!1,!1))}e.append(o),r.selected&&e.val(r.selected),c(e).on("select2:select",function(o){var e,n=r.addresses.find(function(e){return+e.id==+o.params.data.id});void 0!==n&&(e=n.addressObject,c(".coleteonline-address-short-name").html("<b>".concat(e.shortName,"</b>")),c(".coleteonline-address-name").text(e.contact.name),c(".coleteonline-address-company").text(e.contact.company||""),c(".coleteonline-address-phone").html("".concat(e.contact.phone,"\n             ").concat(e.contact.phone2?"<br> "+e.contact.phone2:"")),c(".coleteonline-address-city-county").text("".concat(e.address.city,", ").concat(e.address.county)),c(".coleteonline-address-street-number").text("".concat(e.address.street,", ").concat(e.address.number)),c(".coleteonline-address-postal-country").text("".concat(e.address.postalCode,", ").concat(e.address.countryCode)),n=[e.address.building,e.address.entrance,e.address.floor,e.address.intercom,e.address.entrance,e.address.apartment].filter(function(e){return e}).join(", "),c(".coleteonline-address-other-data").text(n),c(".coleteonline-address-landmark").text(e.address.landmark||""),c(".coleteonline-address-additional-info").text(e.address.additionalInfo||""),c(".coleteonline-address-table").attr("data-address-id",e.locationId))})})}),c("#coleteonline-do-create-courier-order").prop("disabled",!0),c("#coleteonline-couriers-offers").hide(),c(".coleteonline-offers-loading").hide(),c(".coleteonline-do-fetch-services-list").click(function(){c("#coleteonline-show-offers-errors").empty(),c("#coleteonline-show-order-errors").empty(),c("#coleteonline-couriers-offers").show(),c(".coleteonline-offers-loading").show(),c(".coleteonline-do-fetch-services-list").hide(),c("#coleteonline-couriers-offers").find("tbody").empty();var e=c(".coleteonline-address-table")[0].dataset.addressId;c.post(ajaxurl,{action:"coleteonline_get_services_list",data:{orderId:c("#coleteonline-order-id").val(),fromAddressId:e,packages:r[0].getPackagesTotals(),extraOptions:t()}},function(e){if(c(".coleteonline-offers-loading").hide(),c(".coleteonline-do-fetch-services-list").show(),(e=JSON.parse(e)).error)i(e,"#coleteonline-show-offers-errors");else{var o,n,r=null===(o=c("#coleteonline-couriers-offers")[0].dataset)||void 0===o?void 0:o.selectedCourierId,t=_createForOfIteratorHelper(e.list);try{for(t.s();!(n=t.n()).done;){var a=n.value,l='<tr class="'.concat(+r==+a.service.id?"coleteonline-selected-by-client":"",'">\n              <td>\n                <input type="checkbox"\n                  class="coleteonline-selected-courier"\n                  data-courier-id=').concat(a.service.id,"\n                  ").concat(+r==+a.service.id?"checked":"","\n                >\n              </td>\n              <td>").concat(a.service.courierName,"</td>\n              <td>").concat(a.service.name,"</td>\n              <td><b>").concat(a.price.total," ron</b><br>\n                  (").concat(a.price.noVat," ron + TVA)\n              </td>\n            </tr>");c("#coleteonline-couriers-offers").find("tbody").append(l)}}catch(e){t.e(e)}finally{t.f()}}c(".coleteonline-selected-courier:checked").length&&c("#coleteonline-do-create-courier-order").prop("disabled",!1),c(".coleteonline-selected-courier").unbind("change"),c(".coleteonline-selected-courier").change(function(e){c(".coleteonline-selected-courier").prop("checked",!1),c(e.target).prop("checked",!0),c("#coleteonline-do-create-courier-order").prop("disabled",!1)})})}),c(".coleteonline-orders-loading").hide(),c("#coleteonline-do-create-courier-order").click(function(){c("#coleteonline-show-offers-errors").empty(),c("#coleteonline-show-order-errors").empty(),c(".coleteonline-orders-loading").show(),c("#coleteonline-do-create-courier-order").hide();var e=c(".coleteonline-address-table")[0].dataset.addressId,o=c(".coleteonline-selected-courier:checked")[0].dataset.courierId;c.post(ajaxurl,{action:"coleteonline_create_courier_order",data:{orderId:c("#coleteonline-order-id").val(),fromAddressId:e,packages:r[0].getPackagesTotals(),content:c("#coleteonline-order-content-input").val(),selectedCourierId:o,extraOptions:t()}},function(e){c(".coleteonline-orders-loading").hide(),c("#coleteonline-do-create-courier-order").show(),(e=JSON.parse(e)).error?i(e,"#coleteonline-show-order-errors"):(c("#coleteonline_order_shipping_wrapper").empty(),c("#coleteonline_order_shipping_wrapper").html(e.fragments.courierOrders),a())})}),a()}(jQuery);